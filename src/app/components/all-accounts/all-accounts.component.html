<div class="all-accounts-container">
  <h2>All User Accounts</h2>
  
  <!-- <div class="search-controls">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search Accounts</mat-label>
      <input matInput [(ngModel)]="searchTerm" (keyup.enter)="loadAllAccounts()" 
             placeholder="Search by name, email, or phone">
    </mat-form-field>
    
    <button mat-raised-button color="primary" (click)="loadAllAccounts()">
      Refresh
    </button> 
  </div> --->
<!-- Search Controls Section -->
<div class="search-controls">
  <mat-form-field appearance="outline" class="search-field">
    <mat-label>Search Accounts</mat-label>
    <input matInput [(ngModel)]="searchTerm" (keyup.enter)="loadAllAccounts()" 
           placeholder="Search by name, email, phone, or assignee">
  </mat-form-field>

  <!-- Status Filter -->
  <mat-form-field appearance="outline" class="status-filter">
    <mat-label>Status</mat-label>
    <mat-select [(value)]="selectedStatus" (selectionChange)="loadAllAccounts()">
      <mat-option value="">All Status</mat-option>
      <mat-option value="pending">Pending</mat-option>
      <mat-option value="partially_paid">Partially Paid</mat-option>
      <mat-option value="completed">Completed</mat-option>
      <mat-option value="overdue">Overdue</mat-option>
      <!-- <mat-option value="cancelled">Cancelled</mat-option> -->
    </mat-select>
  </mat-form-field>

  <!-- Assignee Filter (Admin only) -->
  <mat-form-field appearance="outline" class="assignee-dropdown" *ngIf="userType === 'admin'">
    <mat-label>Filter by Assignee</mat-label>
    <mat-select [(value)]="selectedAssignee" (selectionChange)="onAssigneeFilterChange()">
      <mat-option value="">All Assignees</mat-option>
      <mat-option *ngFor="let user of assigneeOptions" [value]="user">{{ user }}</mat-option>
    </mat-select>
  </mat-form-field>

  <button mat-raised-button color="primary" (click)="loadAllAccounts()">
    Search
  </button>

  <button mat-raised-button color="basic" (click)="clearFilters()" *ngIf="searchTerm || selectedStatus || selectedAssignee">
    Clear Filters
  </button>
</div>
  <div class="mat-elevation-z2 table-container">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
      <!-- Contact Name Column -->
      <ng-container matColumnDef="contactName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Contact Name</th>
        <td mat-cell *matCellDef="let account">{{ account.contactDetails?.name || 'N/A' }}</td>
      </ng-container>

      <!-- Email Column -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
        <td mat-cell *matCellDef="let account">{{ account.email ||account.contactDetails?.email || 'N/A' }}</td>
      </ng-container>

      <!-- Phone Column -->
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Phone</th>
        <td mat-cell *matCellDef="let account">{{ account.contactDetails?.phone || 'N/A' }}</td>
      </ng-container>

      

      <!-- Total Amount Column -->
      <ng-container matColumnDef="totalAmount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Amount</th>
        <td mat-cell *matCellDef="let account">
          {{ account.totalAmount  }}
        </td>
      </ng-container>

      <!-- Pending Amount Column -->
      <ng-container matColumnDef="pendingAmount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Pending Amount</th>
        <td mat-cell *matCellDef="let account">
          {{ account.pendingAmount  }}
        </td>
      </ng-container>

      <!-- Paid Amount Column -->
      <ng-container matColumnDef="paidAmount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Paid Amount</th>
        <td mat-cell *matCellDef="let account">
          {{ (account.totalAmount - account.pendingAmount) }}
        </td>
      </ng-container>

      <!-- Pending Installments Column -->
      <ng-container matColumnDef="pendingInstallments">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Pending Installments</th>
        <td mat-cell *matCellDef="let account">{{ account.pendingInstallments }}</td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="overallStatus">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let account">
          <span [class]="'status-' + account.overallStatus" class="status-badge">
            {{ account.overallStatus }}
          </span>
        </td>
      </ng-container>

     
                  <ng-container matColumnDef="assigneeSelection">
        <th mat-header-cell *matHeaderCellDef>Assignee</th>
        <td class="lead_status" mat-cell *matCellDef="let element">
          <mat-form-field appearance="outline" class="small-assignee-field" *ngIf="userType === 'admin'">
            <mat-select [(value)]="element.assigneeName" (selectionChange)="onAssigneeSelect($event.value, element.contactRef)">
              <mat-option *ngFor="let user of assigneeOptions" [value]="user">{{ user }}</mat-option>
            </mat-select>
          </mat-form-field>
          <span *ngIf="userType !== 'admin'">{{ element.assigneeName || 'Not Assigned' }}</span>
        </td>
      </ng-container>
      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let account">
          <button mat-raised-button color="primary" 
                  (click)="viewAccountModal(account.contactRef)">
            View Details
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- No data message -->
    <div class="no-data" *ngIf="dataSource.data.length === 0">
      <p>No accounts found</p>
    </div>
  </div>

 <div class="pagination-container">
  <div class="pagination-info">
    <span>{{getStartItem()}}</span>-<span>{{getEndItem()}}</span> of <span>{{totalItems}}</span>
  </div>
  
  <nav aria-label="Contact pagination" class="pagination-controls">
    <ul class="pagination">
      <li class="page-item" [class.disabled]="pageNum === 1" (click)="goToFirstPage()">
        <button class="page-link" type="button" aria-label="First">
          <span aria-hidden="true">&laquo;</span>
        </button>
      </li>
      <li class="page-item" [class.disabled]="pageNum === 1" (click)="goToPreviousPage()">
        <button class="page-link" type="button" aria-label="Previous">
          <span aria-hidden="true">&lsaquo;</span>
        </button>
      </li>
      
      <!-- Page numbers -->
      <div class="page-number-container">
        <li *ngFor="let page of getPageNumbers()"
            class="page-item"
            [class.active]="page === pageNum"
            (click)="goToPage(page)">
          <button class="page-link" type="button">{{page}}</button>
        </li>
      </div>
      
      <li class="page-item" [class.disabled]="pageNum === totalPages" (click)="goToNextPage()">
        <button class="page-link" type="button" aria-label="Next">
          <span aria-hidden="true">&rsaquo;</span>
        </button>
      </li>
      <li class="page-item" [class.disabled]="pageNum === totalPages" (click)="goToLastPage()">
        <button class="page-link" type="button" aria-label="Last">
          <span aria-hidden="true">&raquo;</span>
        </button>
      </li>
    </ul>
  </nav>
</div>
</div>